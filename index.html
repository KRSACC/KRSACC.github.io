<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KRSACC</title>
  <style>
    body{font-family:Arial,sans-serif;background:#f5f5f5;margin:0;padding:0}
    header{background:#111;color:#fff;padding:26px 16px;text-align:center}
    header h1{margin:0;font-size:42px;letter-spacing:2px}
    header p{margin:10px 0 0;opacity:.9;font-size:14px}

    /* 상단 바 */
    .topbar{
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap:8px;
      padding:10px 12px;
      border-bottom:1px solid #eee;
      position:sticky;
      top:0;
      z-index:10;
    }
    .navbtn{
      padding:10px 14px;
      border:none;
      border-radius:10px;
      cursor:pointer;
      background:#666;
      color:#fff;
      font-weight:700;
      font-size:13px;
    }
    .navbtn.dark{background:#444}
    .navbtn.danger{background:#b00020}

    .wrap{max-width:980px;margin:18px auto;padding:0 14px}
    .card{
      background:#fff;
      border-radius:14px;
      padding:18px;
      margin:14px 0;
      box-shadow:0 1px 0 rgba(0,0,0,.03);
      border:1px solid #eee;
    }
    .card h2{margin:0 0 10px;font-size:22px}
    .muted{color:#777;font-size:13px;margin-top:8px;line-height:1.45}

    .balance{
      font-size:34px;
      font-weight:800;
      margin:6px 0 0;
    }

    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .btn{
      padding:12px 14px;
      border:none;
      border-radius:12px;
      cursor:pointer;
      background:#111;
      color:#fff;
      font-weight:800;
      font-size:14px;
    }
    .btn.gray{background:#555}
    .btn.light{background:#e9e9e9;color:#111}
    .btn.link{background:#111}
    .btn.wide{min-width:160px}

    @media (max-width:560px){
      header h1{font-size:34px}
      .balance{font-size:30px}
      .navbtn{padding:9px 12px}
      .btn.wide{min-width:0;flex:1}
      .topbar{justify-content:center}
    }
  </style>
</head>

<body>

  <!-- ✅ 상단 버튼(메인에서도 유지) -->
  <div class="topbar">
    <button class="navbtn dark" onclick="location.href='index.html'">메인</button>
    <button class="navbtn" onclick="location.href='shop.html'">상품</button>
    <button class="navbtn" onclick="location.href='charge.html'">충전</button>
    <button class="navbtn" onclick="location.href='me.html'">내 정보</button>
    <button class="navbtn danger" id="logoutBtn">로그아웃</button>
  </div>

  <header>
    <h1>KRSACC</h1>
    <p>각종 게임 · OTT 전국 최저가</p>
  </header>

  <div class="wrap">

    <div class="card">
      <h2>내 잔액</h2>
      <div class="balance" id="balance">불러오는 중...</div>

      <div class="row">
        <button class="btn wide" onclick="location.href='charge.html'">충전하기</button>
        <button class="btn gray wide" onclick="location.href='shop.html'">상품 보러가기</button>
      </div>

      
    </div>

    <div class="card">
      <h2>바로가기</h2>
      <div class="row">
        <!-- ✅ 여기 링크만 네 거로 바꿔도 됨 -->
        <button class="btn light wide" id="discordBtn">디스코드</button>
        <button class="btn light wide" id="telegramBtn">텔레그램</button>
      </div>
      
    </div>

  </div>

  <script type="module">
    import { auth, db } from "./firebase.js";
    import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const balanceEl = document.getElementById("balance");
    const logoutBtn = document.getElementById("logoutBtn");

    // ✅ 디스코드/텔레그램 링크 (원하는 링크로 바꿔)
    const DISCORD_URL = "https://discord.com/";
    const TELEGRAM_URL = "https://t.me/";

    document.getElementById("discordBtn").onclick = () => window.open(DISCORD_URL, "_blank");
    document.getElementById("telegramBtn").onclick = () => window.open(TELEGRAM_URL, "_blank");

    async function ensureUserDoc(user){
      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);
      if (!snap.exists()) {
        await setDoc(ref, {
          email: user.email || "",
          balance: 0,
          createdAt: Date.now()
        });
      }
      return ref;
    }

    async function loadBalance(userRef){
      const snap = await getDoc(userRef);
      const data = snap.data() || {};
      const bal = data.balance || 0;
      balanceEl.textContent = bal.toLocaleString() + "원";
    }

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        location.href = "login.html";
        return;
      }
      const userRef = await ensureUserDoc(user);
      await loadBalance(userRef);
    });

    logoutBtn.onclick = async () => {
      await signOut(auth);
      location.href = "login.html";
    };
  </script>

</body>
</html>
